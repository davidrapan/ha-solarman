#
# Sofar Modbus protocol G3
# Valid for:
# - HYD 3-6K-EP
# - HYD 5-20K-3PH
# - HYD 5-20KTL-3PH
# - SOFAR 5-24KTL-G3
# - SOFAR 80-136KTL
#
# This works also for rebranded ZCS Azzurro 3-Phase inverters such as the 3PH
# HYD6000 ZSS, or single phase such as 1PH HY6000 ZSS HP. Note that this won't
# work if your ZCS inverter is connected via Connext, you have to be using a
# Wi-Fi or Ethernet Kit such as ZSM-WIFI-USB.
#
# Reference: https://github.com/user-attachments/files/17180102/SOFAR-G3.External.Modbus.Protocol-EN-V1.10.20220622.xlsx
# https://github.com/davidrapan/ha-solarman/wiki/Documentation#sofar
#

default:
  update_interval: 10
  digits: 6

parameters:

  #Inverter{{{
  - group: Inverter
    items:

      - name: "Inverter status"
        rule: 1
        registers: [0x0404]
        lookup:
          - key: 0
            value: "Waiting"
          - key: 1
            value: "Detection"
          - key: 2
            value: "Grid-connected"
          - key: 3
            value: "Emergency power supply"
          - key: 4
            value: "Recoverable fault"
          - key: 5
            value: "Permanent fault"
          - key: 6
            value: "Upgrade"
          - key: 7
            value: "Self-charging"
          - key: 8
            value: "SVG"
          - key: 9
            value: "PID"
        icon: "mdi:wrench"
        description: |-
          Operating status
          0: waiting state
          1: Detection status
          2: Grid-connected status
          3: Emergency power supply status
          4: Recoverable fault state
          5: Permanent fault status
          6: Upgrade status
          7: Self-charging status
          8：SVG status
          9：PID status

      - name: "Ambient temperature 1"
        class: "temperature"
        uom: "°C"
        rule: 2
        registers: [0x0418]
        icon: "mdi:thermometer"

      - name: "Ambient temperature 2"
        class: "temperature"
        uom: "°C"
        rule: 2
        registers: [0x0419]
        icon: "mdi:thermometer"

      - name: "Radiator temperature 1"
        class: "temperature"
        uom: "°C"
        rule: 2
        registers: [0x041A]
        icon: "mdi:thermometer"

      - name: "Radiator temperature 2"
        class: "temperature"
        uom: "°C"
        rule: 2
        registers: [0x041B]
        icon: "mdi:thermometer"

      - name: "Radiator temperature 3"
        class: "temperature"
        uom: "°C"
        rule: 2
        registers: [0x041C]
        icon: "mdi:thermometer"

      - name: "Radiator temperature 4"
        class: "temperature"
        uom: "°C"
        rule: 2
        registers: [0x041D]
        icon: "mdi:thermometer"

      - name: "Radiator temperature 5"
        class: "temperature"
        uom: "°C"
        rule: 2
        registers: [0x041E]
        icon: "mdi:thermometer"

      - name: "Radiator temperature 6"
        class: "temperature"
        uom: "°C"
        rule: 2
        registers: [0x041F]
        icon: "mdi:thermometer"

      - name: "Module temperature 1"
        class: "temperature"
        uom: "°C"
        rule: 2
        registers: [0x0420]
        icon: "mdi:thermometer"

      - name: "Module temperature 2"
        class: "temperature"
        uom: "°C"
        rule: 2
        registers: [0x0421]
        icon: "mdi:thermometer"

      - name: "Module temperature 3"
        class: "temperature"
        uom: "°C"
        rule: 2
        registers: [0x0422]
        icon: "mdi:thermometer"

      - name: "Production Time Today"
        class: "duration"
        state_class: "measurement"
        uom: "min"
        rule: 1
        registers: [0x0426]
        icon: "mdi:clock"
        description: |-
          Day of power generation time

      - name: "Insulation resistance"
        state_class: "measurement"
        uom: "kΩ"
        rule: 1
        registers: [0x042B]
        icon: "mdi:omega"

      - name: "Serial Number"
        rule: 5
        registers: [0x0445, 0x0446, 0x0447, 0x0448, 0x0449, 0x044A, 0x044B, 0x044C] # serial number 17th to 20th digits are in 0x0470 and 0x0471
        icon: "mdi:barcode"
        # description: |-
        #   The 1st and 2nd digits of the serial number. The High 8-bits store the 1st digit of Serial Number, The low 8-bits Store the 2nd digit of Serial number
        #   The 3rd and 4th digits of the serial number. The High 8-bits store the 3rd digit of Serial Number, The low 8-bits Store the 4th digit of Serial number
        #   The 5th and 6th digits of the serial number. The High 8-bits store the5th digit of Serial Number, The low 8-bit Store the 6th digit of Serial number
        #   The 7th and 8th digits of the serial number. The High 8-bits store the 7th digit of Serial Number, The low 8-bits Store the 8th digit of Serial number
        #   The 9th and 10th digits of the serial number. The High 8-bits store the 9th digit of Serial Number, The low 8-bits Store the 10th digit of Serial number
        #   The 11th and 12th digits of the serial number. The High 8-bits store the 11th digit of Serial Number, The low 8-bits Store the 12th digit of Serial number
        #   The 13th and 14th digits of the serial number. The High 8-bits store the 13th digit of Serial Number, The low 8-bits Store the 14th digit of Serial number
        #   The 15th and 16th digits of the serial number. The High 8-bits store the 15th digit of Serial Number, The low 8-bits Store the 16th digit of Serial number

      - name: "Hardware Version"
        rule: 5
        registers: [0x044D, 0x044E]
        icon: "mdi:alpha-v"
        # description: |-
        #   The 1st and 2nd digits of the Hardware Version. The High 8-bits store the 1st digit of Serial Number, The low 8-bits Store the 2nd digit of Serial number
        #   The 3rd and 4th digits of the Hardware Version. The High 8-bits store the 3rd digit of Serial Number, The low 8-bits Store the 4th digit of Serial number

      - name: "Software Version Master"
        rule: 5
        registers: [0x0453, 0x0454, 0x0455, 0x0456]
        icon: "mdi:alpha-v"
        # description: |-
        #   Bytes for main control chip's software version number, The lower 8 bits of the register store the ASCII code. The default value of the official version start with 'V'. The high 8 bits of the register store the higher digits; The low 8 bits of the register store the lower digits.
        #   Software version number  for main control chip. For one system, the software version number  need to be consistent for all chips. The high 8 bits of the register store the higher digits; The low 8 bits of the register store the lower digits.
        #   Non-standard customization software version number for main control chip. The standard software version should be00,For one system, the Non-standard customization  software version number  need to be consistent for all chips, otherwise it will consider as Fault.  The high 8 bits of the register store the higher digits; The low 8 bits of the register store the lower digits.
        #   software subversion number for main control chip. The high 8 bits of the register store the higher digits; The low 8 bits of the register store the lower digits.

      - name: "Software Version Slave"
        rule: 5
        registers: [0x0457, 0x0458, 0x0459, 0x045A]
        icon: "mdi:alpha-v"
        # description: |-
        #   Bits for Secondary control chip's software version number, The lower 8 bits of the register store the ASCII code. The default value of the official version is'V'.The high 8 bits of the register store the higher digits; The low 8 bits of the register store the lower digits.
        #   Software version number  for Secondary control chip. For one system, the software version number  need to be consistent for all chips. The high 8 bits of the register store the higher digits; The low 8 bits of the register store the lower digits.
        #   Non-standard customization software version number for secondary control chip. The standard software version should be00,For one system, the Non-standard customization  software version number  need to be consistent for all chips, otherwise it will consider as Fault.  The high 8 bits of the register store the higher digits; The low 8 bits of the register store the lower digits.
        #   software subversion number for secondary control chip. The high 8 bits of the register store the higher digits; The low 8 bits of the register store the lower digits.

      - name: "Safety Version"
        rule: 7
        registers: [0x045B, 0x045C]
        icon: "mdi:alpha-v"
        description: |-
          main version number for Safety regulation library
          Sub-version number for Safety regulation library

      - name: "Safety Firmware Version"
        rule: 5
        registers: [0x0460, 0x0461, 0x0462, 0x0463]
        icon: "mdi:alpha-v"
        # description: |-
        #   Safety certification software version number stage definition bit.
        #   The lower 8 bits of the register store the ASCII code. The default value of the official version is'V'.
        #   The high 8 bits of the register store the high digits;
        #   The lower 8 bits of the register store the lower digits.
        #   The major version number of the safety certification software.
        #   The major version numbers of all chips in the same system must be the same, otherwise it will be regarded as a system failure.
        #   The high 8 bits of the register store the high digits;
        #   The lower 8 bits of the register store the lower digits.
        #   Safety certification software non-standard customized version number.
        #   The version number of the standard software is 00. The non-standard customized version numbers of all chips in the same system must be the same, otherwise it will be regarded as a system failure.
        #   The high 8 bits of the register store the high digits;
        #   The lower 8 bits of the register store the lower digits.
        #   Safety certification software version number.
        #   The high 8 bits of the register store the high digits;
        #   The lower 8 bits of the register store the lower digits.

      - name: "Safety Hardware Version"
        rule: 5
        registers: [0x0464, 0x0465]
        icon: "mdi:alpha-v"
        # description: |-
        #   Safety certification hardware version number 1st and 2nd.
        #   The upper 8 bits of the register store the first bit of the serial number;
        #   The lower 8 bits of the register store the second bit of the serial number.
        #   The 3rd and 4th digits of the hardware version number of safety certification.
        #   The upper 8 bits of the register store the third bit of the serial number;
        #   The lower 8 bits of the register store the 4th bit of the serial number.

  #}}}
  # InverterDC{{{
  - group: InverterDC
    items:

      # MPPT1{{{
      - name: "PV1 Voltage"
        class: "voltage"
        mppt: 1
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [0x0584]
        icon: "mdi:solar-power"
        description: |-
          The first PV voltage

      - name: "PV1 Current"
        class: "current"
        mppt: 1
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 1
        registers: [0x0585]
        icon: "mdi:solar-power"
        description: |-
          The first PV current

      - name: "PV1 Power"
        class: "power"
        mppt: 1
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 1
        registers: [0x0586]
        icon: "mdi:solar-power"
        description: |-
          PV power of the first road

      #}}}
      # MPPT2{{{
      - name: "PV2 Voltage"
        class: "voltage"
        mppt: 2
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [0x0587]
        icon: "mdi:solar-power"
        description: |-
          The second PV voltage

      - name: "PV2 Current"
        class: "current"
        mppt: 2
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 1
        registers: [0x0588]
        icon: "mdi:solar-power"
        description: |-
          The second PV current

      - name: "PV2 Power"
        class: "power"
        mppt: 2
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 1
        registers: [0x0589]
        icon: "mdi:solar-power"
        description: |-
          PV power of the 2nd road

      #}}}
      # MPPT3{{{
      - name: "PV3 Voltage"
        mppt: 3
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [0x058a]
        icon: "mdi:solar-power"

      - name: "PV3 Current"
        mppt: 3
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 1
        registers: [0x058b]
        icon: "mdi:solar-power"

      - name: "PV3 Power"
        mppt: 3
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 1
        registers: [0x058c]
        icon: "mdi:solar-power"

      #}}}
      # MPPT4{{{
      - name: "PV4 Voltage"
        mppt: 4
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [0x058d]
        icon: "mdi:solar-power"

      - name: "PV4 Current"
        mppt: 4
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 1
        registers: [0x058e]
        icon: "mdi:solar-power"

      - name: "PV4 Power"
        mppt: 4
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 1
        registers: [0x058f]
        icon: "mdi:solar-power"

      #}}}
      - name: "PV Power"
        alt: "Power PV Total"
        class: "power"
        mppt: 1
        state class: "measurement"
        uom: "W"
        scale: 100
        rule: 1
        registers: [0x05C4]
        icon: "mdi:solar-power"
        description: |-
          Total PV power

  #}}}
  # Battery{{{
  - group: Battery
    items:

      # Battery 1{{{
      - name: "Battery Voltage"
        pack: 1
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [0x0604]
        icon: "mdi:battery"
        description: |-
          No. 1 battery pack voltage

      - name: "Battery Current"
        pack: 1
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 2
        registers: [0x0605]
        icon: "mdi:current-dc"
        description: |-
          The charging and discharging current of the first battery pack. Charge is positive, discharge is negative

      - name: "Battery Power"
        pack: 1
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x0606]
        icon: "mdi:battery-charging"
        description: |-
          The charging and discharging power of the first battery pack. Charge is positive, discharge is negative

      - name: "Battery Temperature"
        pack: 1
        class: "temperature"
        state_class: "measurement"
        uom: "°C"
        rule: 2
        registers: [0x0607]
        icon: "mdi:battery"
        description: |-
          Ambient temperature of the first battery pack

      - name: "Battery"
        pack: 1
        class: "battery"
        state_class: "measurement"
        uom: "%"
        rule: 1
        registers: [0x0608]
        icon: "mdi:battery"
        description: |-
          No. 1 battery pack SOC

      - name: "Battery State of Health"
        alt: "Battery SOH"
        pack: 1
        state_class: "measurement"
        uom: "%"
        rule: 1
        registers: [0x0609]
        icon: "mdi:battery"
        description: |-
          No. 1 battery pack SOH

      - name: "Battery Number of Cycles"
        pack: 1
        state_class: "measurement"
        uom: "cycle"
        rule: 1
        registers: [0x060A]
        icon: "mdi:battery"
        description: |-
          Number of cycles of the first battery pack

      #}}}
      # Battery 2{{{
      - name: "Battery 2 Voltage"
        pack: 2
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [0x0604]
        icon: "mdi:battery"
        description: |-
          No. 2 battery pack voltage

      - name: "Battery 2 Current"
        pack: 2
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 2
        registers: [0x0605]
        icon: "mdi:current-dc"
        description: |-
          The charging and discharging current of the second battery pack. Charge is positive, discharge is negative

      - name: "Battery 2 Power"
        pack: 2
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x0606]
        icon: "mdi:battery-charging"
        description: |-
          The charging and discharging power of the second battery pack. Charge is positive, discharge is negative

      - name: "Battery 2 Temperature"
        pack: 2
        class: "temperature"
        state_class: "measurement"
        uom: "°C"
        rule: 2
        registers: [0x0607]
        icon: "mdi:battery"
        description: |-
          Ambient temperature of the second battery pack

      - name: "Battery 2"
        pack: 2
        class: "battery"
        state_class: "measurement"
        uom: "%"
        rule: 1
        registers: [0x0608]
        icon: "mdi:battery"
        description: |-
          No. 2 battery pack SOC

      - name: "Battery 2 State of Health"
        alt: "Battery 2 SOH"
        pack: 2
        state_class: "measurement"
        uom: "%"
        rule: 1
        registers: [0x0609]
        icon: "mdi:battery"
        description: |-
          No. 2 battery pack SOH

      - name: "Battery 2 Number of Cycles"
        pack: 2
        state_class: "measurement"
        uom: "cycle"
        rule: 1
        registers: [0x060A]
        icon: "mdi:battery"
        description: |-
          Number of cycles of the second battery pack

      #}}}
      - name: "Battery Depth of Discharge"
        alt: "Battery DOD"
        state_class: "measurement"
        uom: "%"
        rule: 1
        registers: [0x104D]
        icon: "mdi:battery"
        description: |-
          Dod indicates the max discharge power, when SOC<1-DOD, inverter will stop power discharge , inverter will stop power discharge caused by other issues.        DOD<=EOD

      - name: "Battery End of Discharge"
        alt: "Battery EOD"
        state_class: "measurement"
        uom: "%"
        rule: 1
        registers: [0x104E]
        icon: "mdi:battery"
        description: "EOD indicate the max discharge power on off grid mode, when SOC<1-EOD, inverter will stop power discharge , inverter will stop power discharge caused by other issues. "

      - name: "Battery EPS Buffer"
        state_class: "measurement"
        uom: "%"
        rule: 1
        registers: [0x1052]
        icon: "mdi:battery-low"
        description: |-
          Battery parameters-off-grid recovery discharge hysteresis;
          EPS_Buffer is not greater than EOD

  #}}}
  # Grid{{{
  - group: Grid
    items:

      - name: "Grid Frequency"
        class: "frequency"
        state_class: "measurement"
        uom: "Hz"
        scale: 0.01
        rule: 1
        registers: [0x0484]
        icon: "mdi:home-lightning-bolt"
        description: |-
          Grid frequency

      - name: "ActivePower Output Total"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x0485]
        icon: "mdi:home-lightning-bolt"
        description: |-
          Total active power. Discharge is positive, charge is negative

      - name: "ReactivePower Output Total"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x0486]
        icon: "mdi:home-lightning-bolt"
        description: |-
          Total reactive power. The inverter end is positive for leading and negative for lagging

      - name: "ApparentPower Output Total"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x0487]
        icon: "mdi:home-lightning-bolt"
        description: |-
          Total apparent power. Discharge is positive, charge is negative

      - name: "ActivePower PCC Total"
        class: "power"
        state_class: "measurement"
        uom: "W"
        # Reversing the original value to match the other ha-solarman inverters
        # https://github.com/davidrapan/ha-solarman/discussions/458
        scale: -10
        rule: 2
        registers: [0x0488]
        icon: "mdi:home-lightning-bolt"
        description: |-
          Total PCC active power. Selling electricity is negative, buying electricity is positive

      - name: "ReactivePower PCC Total"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x0489]
        icon: "mdi:home-lightning-bolt"
        description: |-
          Total PCC reactive power. The inverter end is positive for lead and negative for lag

      - name: "ApparentPower PCC Total"
        class: "power"
        state_class: "measurement"
        uom: "W"
        # Reversing the original value to match the other ha-solarman inverters
        # https://github.com/davidrapan/ha-solarman/discussions/458
        scale: -10
        rule: 2
        registers: [0x048A]
        icon: "mdi:home-lightning-bolt"
        description: |-
          Total PCC apparent power. Selling electricity is negative, buying electricity is positive

      # Phase 1{{{
      - name: "Voltage Phase L1"
        l: 1
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [0x048D]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          R phase grid voltage

      - name: "Current Output L1"
        l: 1
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 1
        registers: [0x048E]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          R-phase inverter output current

      - name: "ActivePower Output L1"
        l: 1
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x048F]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          The R-phase inverter outputs active power. Discharge is positive, charge is negative

      - name: "ReactivePower Output L1"
        l: 1
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x0490]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          The R-phase inverter outputs reactive power. The inverter end is positive for lead and negative for lag

      - name: "PowerFactor Output L1"
        l: 1
        class: "powerfactor"
        state_class: "measurement"
        uom: "p.u."
        scale: 0.001
        rule: 2
        registers: [0x0491]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          R-phase power factor. The inverter end is positive for lead and negative for lag

      - name: "Current PCC L1"
        l: 1
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 1
        registers: [0x0492]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          R phase PCC current

      - name: "ActivePower PCC L1"
        l: 1
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x0493]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          R-phase PCC active power

      - name: "ReactivePower PCC L1"
        l: 1
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x0494]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          R-phase PCC reactive power. The inverter end is positive for lead and negative for lag

      - name: "PowerFactor PCC L1"
        l: 1
        class: "powerfactor"
        state_class: "measurement"
        uom: "p.u."
        scale: 0.001
        rule: 2
        registers: [0x0495]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          R-phase PCC power factor. The inverter end is positive for lead and negative for lag

      #}}}
      # Phase 2{{{
      - name: "Voltage Phase L2"
        l: 2
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [0x0498]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          S phase grid voltage

      - name: "Current Output L2"
        l: 2
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 1
        registers: [0x0499]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          S phase inverter output current

      - name: "ActivePower Output L2"
        l: 2
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x049A]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          The S-phase inverter outputs active power. Discharge is positive, charge is negative

      - name: "ReactivePower Output L2"
        l: 2
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x049B]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          The S-phase inverter outputs reactive power. The inverter end is positive for lead and negative for lag

      - name: "PowerFactor Output L2"
        l: 2
        class: "powerfactor"
        state_class: "measurement"
        uom: "p.u."
        scale: 0.001
        rule: 2
        registers: [0x049C]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          S-phase power factor. The inverter end is positive for lead and negative for lag

      - name: "Current PCC L2"
        l: 2
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 1
        registers: [0x049D]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          S phase PCC current

      - name: "ActivePower PCC L2"
        l: 2
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x049E]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          S-phase PCC active power. Discharge is positive, charge is negative

      - name: "ReactivePower PCC L2"
        l: 2
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x049F]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          S-phase PCC reactive power. The inverter end is positive for lead and negative for lag

      - name: "PowerFactor PCC L2"
        l: 2
        class: "powerfactor"
        state_class: "measurement"
        uom: "p.u."
        scale: 0.001
        rule: 2
        registers: [0x04A0]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          S-phase PCC power factor. The inverter end is positive for lead and negative for lag

      #}}}
      # Phase 3{{{
      - name: "Voltage Phase L3"
        l: 3
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [0x04A3]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          T phase grid voltage

      - name: "Current Output L3"
        l: 3
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 1
        registers: [0x04A4]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          T-phase inverter output current

      - name: "ActivePower Output L3"
        l: 3
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x04A5]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          The T-phase inverter outputs active power. Discharge is positive, charge is negative

      - name: "ReactivePower Output L3"
        l: 3
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x04A6]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          The T-phase inverter outputs reactive power. The inverter end is positive for lead and negative for lag

      - name: "PowerFactor Output L3"
        l: 3
        class: "powerfactor"
        state_class: "measurement"
        uom: "p.u."
        scale: 0.001
        rule: 2
        registers: [0x04A7]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          T-phase power factor. The inverter end is positive for lead and negative for lag

      - name: "Current PCC L3"
        l: 3
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 1
        registers: [0x04A8]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          T phase PCC current

      - name: "ActivePower PCC L3"
        l: 3
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x04A9]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          T-phase PCC active power. Discharge is positive, charge is negative

      - name: "ReactivePower PCC L3"
        l: 3
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x04AA]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          T-phase PCC reactive power. The inverter end is positive for lead and negative for lag

      - name: "PowerFactor PCC L3"
        l: 3
        class: "powerfactor"
        state_class: "measurement"
        uom: "p.u."
        scale: 0.001
        rule: 2
        registers: [0x04AB]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          T-phase PCC power factor. The inverter end is positive for lead and negative for lag

      #}}}

      - name: "ActivePower PV Ext"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 1
        registers: [0x04AE]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          External power generation

      - name: "ActivePower Load Sys"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x04AF]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          System total load power

  #}}}
  # GridEPS{{{
  - group: GridEPS
    items:

      - name: "ActivePower Load Total EPS"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x0504]
        icon: "mdi:home-lightning-bolt"
        description: "Load active power. "

      - name: "ReactivePower Load Total EPS"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x0505]
        icon: "mdi:home-lightning-bolt"
        description: |-
          Load consumption is positive, and feedback is negative

      - name: "ApparentPower Load Total EPS"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x0506]
        icon: "mdi:home-lightning-bolt"
        description: |-
          Load reactive power
          Apparent power of the load. Load consumption is positive, and feedback is negative

      - name: "Frequency Output EPS"
        class: "frequency"
        state_class: "measurement"
        uom: "Hz"
        scale: 0.01
        rule: 1
        registers: [0x0507]
        icon: "mdi:home-lightning-bolt"
        description: |-
          Output voltage frequency

      # Phase 1{{{
      - name: "Voltage Output L1 EPS"
        l: 1
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [0x050A]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          R-phase inverter output voltage

      - name: "Current Load L1 EPS"
        l: 1
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 1
        registers: [0x050B]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          R phase load current

      - name: "ActivePower Load L1 EPS"
        l: 1
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x050C]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          R-phase load active power. Load consumption is positive, and feedback is negative.

      - name: "ReactivePower Load L1 EPS"
        l: 1
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x050D]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          R-phase load reactive power. The inverter end is positive for lead and negative for lag

      - name: "ApparentPower Load L1 EPS"
        l: 1
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x050E]
        icon: "mdi:home-lightning-bolt"
        description: |-
          Apparent power of R-phase load. Load consumption is positive, and feedback is negative.

      - name: "LoadPeakRatio L1 EPS"
        l: 1
        class: "powerfactor"
        state_class: "measurement"
        uom: "p.u."
        scale: 0.01
        rule: 2
        registers: [0x050F]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          R phase load peak ratio

      #}}}
      # Phase 2{{{
      - name: "Voltage Output L2 EPS"
        l: 2
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [0x0512]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          S phase inverter output voltage

      - name: "Current Load L2 EPS"
        l: 2
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 1
        registers: [0x0513]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          S phase load current

      - name: "ActivePower Load L2 EPS"
        l: 2
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x0514]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          S-phase load active power. Load consumption is positive, and feedback is negative.

      - name: "ReactivePower Load L2 EPS"
        l: 2
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x0515]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          S-phase load reactive power. The inverter end is positive for lead and negative for lag

      - name: "ApparentPower Load L2 EPS"
        l: 2
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x0516]
        icon: "mdi:home-lightning-bolt"
        description: |-
          Apparent power of S-phase load. Load consumption is positive, and feedback is negative.

      - name: "LoadPeakRatio L2 EPS"
        l: 2
        class: "powerfactor"
        state_class: "measurement"
        uom: "p.u."
        scale: 0.01
        rule: 2
        registers: [0x0517]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          S phase load peak ratio

      #}}}
      # Phase 3{{{
      - name: "Voltage Output L3 EPS"
        l: 3
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [0x051A]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          T-phase inverter output voltage

      - name: "Current Load L3 EPS"
        l: 3
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 1
        registers: [0x051B]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          T phase load current

      - name: "ActivePower Load L3 EPS"
        l: 3
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x051C]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          T-phase load active power. Load consumption is positive, and feedback is negative.

      - name: "ReactivePower Load L3 EPS"
        l: 3
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x051D]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          T-phase load reactive power. The inverter end is positive for lead and negative for lag

      - name: "ApparentPower Load L3 EPS"
        l: 3
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 10
        rule: 2
        registers: [0x051E]
        icon: "mdi:home-lightning-bolt"
        description: |-
          Apparent power of T-phase load. Load consumption is positive, and feedback is negative.

      - name: "LoadPeakRatio L3 EPS"
        l: 3
        class: "powerfactor"
        state_class: "measurement"
        uom: "p.u."
        scale: 0.01
        rule: 2
        registers: [0x051F]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          T-phase load peak ratio

      #}}}

  #}}}
  # Production{{{
  - group: Production
    items:

      - name: "Today Production"
        friendly_name: Today's Production
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.01
        rule: 3
        registers: [0x0685, 0x0684]
        icon: "mdi:solar-power"
        description: |-
          Power generation of the day

      - name: "Total Production"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 3
        registers: [0x0687, 0x0686]
        icon: "mdi:solar-power"
        validation:
          min: 0.1
        description: |-
          Total power generation time

      - name: "Today Load Consumption"
        friendly_name: Today's Load Consumption
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.01
        rule: 3
        registers: [0x0689, 0x0688]
        icon: "mdi:lightning-bolt-outline"
        description: |-
          Load power consumption of the day

      - name: "Total Load Consumption"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 3
        registers: [0x068B, 0x068A]
        icon: "mdi:solar-power"
        validation:
          min: 0.1
        description: |-
          Total load power consumption

      - name: Today Energy Import
        alt: Daily Energy Bought
        friendly_name: Today's Energy Import
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.01
        rule: 3
        registers: [0x068D, 0x068C]
        icon: "mdi:transmission-tower-export"
        description: |-
          Buy electricity on the day

      - name: Total Energy Import
        alt: Total Energy Bought
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 3
        registers: [0x068F, 0x068E]
        icon: "mdi:transmission-tower-export"
        validation:
          min: 0.1
        description: |-
          Total electricity purchased

      - name: "Today Energy Export"
        alt: Daily Energy Sold
        friendly_name: Today's Energy Export
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.01
        rule: 3
        registers: [0x0691, 0x0690]
        icon: "mdi:transmission-tower-import"
        description: |-
          Electricity sold on the day

      - name: Total Energy Export
        alt: Total Energy Sold
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 3
        registers: [0x0693, 0x0692]
        icon: "mdi:transmission-tower-import"
        validation:
          min: 0.1
        description: |-
          Total electricity sold

      - name: "Today Battery Charge"
        friendly_name: Today's Battery Charge
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.01
        rule: 3
        registers: [0x0695, 0x0694]
        icon: "mdi:battery-plus"
        description: |-
          Battery charge capacity of the day

      - name: "Total Battery Charge"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 3
        registers: [0x0697, 0x0696]
        icon: "mdi:battery-plus"
        validation:
          min: 0.1
        description: |-
          Total battery charge

      - name: "Today Battery Discharge"
        friendly_name: Today's Battery Discharge
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.01
        rule: 3
        registers: [0x0699, 0x0698]
        icon: "mdi:battery-minus"
        description: |-
          Battery discharge capacity of the day

      - name: "Total Battery Discharge"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 3
        registers: [0x069b, 0x069A]
        icon: "mdi:battery-minus"
        validation:
          min: 0.1
        description: |-
          Total battery discharge

  #}}}
  # Alert{{{
  - group: Alert
    items:

      - name: "Alert"
        rule: 6
        icon: "mdi:alert"
        registers:
          [
            0x0405,
            0x0406,
            0x0407,
            0x0408,
            0x0409,
            0x040A,
            0x040B,
            0x040C,
            0x040D,
            0x040E,
            0x040F,
            0x0410,
          ]
        lookup:
        # Fault 1-12{{{

          # name: "Fault 1"
          # registers: [0x0405]
          - key: 0
            value: "No error"
          - key: 1
            value: "ID01 Grid Over Voltage Protection"
          - key: 2
            value: "ID02 Grid Under Voltage Protection"
          - key: 4
            value: "ID03 Grid Over Frequency Protection"
          - key: 8
            value: "ID04 Grid Under Frequency Protection"
          - key: 10
            value: "LOOKUP" # off-grid
          - key: 14
            value: "ID03 Grid Over Frequency Protection" # also ID14 Grid voltage unbalance
          - key: 16
            value: "ID05 Leakage current fault"
          - key: 32
            value: "ID06 High penetration error"
          - key: 64
            value: "ID07 Low penetration error"
          - key: 128
            value: "ID08 Islanding error"
          - key: 256
            value: "ID09 Grid voltage transient value overvoltage 1"
          - key: 512
            value: "ID10 Grid voltage transient value overvoltage 2"
          - key: 1024
            value: "ID11 Grid line voltage error"
          - key: 2048
            value: "ID12 Inverter voltage error"
          - key: 4096
            value: "ID13 Anti-backflow overload"
          - key: 8192
            value: "ID14"
          - key: 16384
            value: "ID15"
          - key: 32768
            value: "ID16"

          # name: "Fault 2"
          # registers: [0x0406]
          - key: 65536
            value: "No error"
          - key: 131072
            value: "ID17 Grid current sampling error"
          - key: 262144
            value: "ID18 Grid current DC component sampling error (AC side)"
          - key: 524288
            value: "ID19 Grid voltage sampling error (DC side)"
          - key: 1048576
            value: "ID20 Grid voltage sampling error (AC side)"
          - key: 2097152
            value: "ID21 Leakage current sampling error (DC side)"
          - key: 4194304
            value: "ID22 Leakage current sampling error (AC side)"
          - key: 8388608
            value: "ID23 Load voltage DC component sampling error"
          - key: 16777216
            value: "ID24 DC input current sampling error"
          - key: 33554432
            value: "ID25 DC component sampling error of grid current (DC side)"
          - key: 67108864
            value: "ID26 DC input branch current sampling error"
          - key: 134217728
            value: "ID27"
          - key: 268435456
            value: "ID28"
          - key: 536870912
            value: "ID29 Leakage current consistency error"
          - key: 1073741824
            value: "ID30 Grid voltage consistency error"
          - key: 2147483648
            value: "ID31 DCI consistency error"
          - key: 4294967296
            value: "ID32"

          # name: "Fault 3"
          # registers: [0x0407]
          - key: 8589934592
            value: "No error"
          - key: 17179869184
            value: "ID033 SPI communication error (DC side)"
          - key: 34359738368
            value: "ID034 SPI communication error (AC side)"
          - key: 68719476736
            value: "ID035 Chip error (DC side)"
          - key: 137438953472
            value: "ID036 Chip error (AC side)"
          - key: 274877906944
            value: "ID037 Auxiliary power error"
          - key: 549755813888
            value: "ID038 Inverter soft start failure"
          - key: 1099511627776
            value: "ID039 "
          - key: 2199023255552
            value: "ID040 "
          - key: 4398046511104
            value: "ID041 Relay detection failure"
          - key: 8796093022208
            value: "ID042 Low insulation impedance"
          - key: 17592186044416
            value: "ID043 Grounding error"
          - key: 35184372088832
            value: "ID044 Input mode setting error"
          - key: 70368744177664
            value: "ID045 CT error"
          - key: 140737488355328
            value: "ID046 Input reversal error"
          - key: 281474976710656
            value: "ID047 Parallel error"
          - key: 562949953421312
            value: "ID048 Serial number error"

          # name: "Fault 4"
          # registers: [0x0408]
          - key: 1125899906842624
            value: "No error"
          - key: 2251799813685248
            value: "ID049 Battery temperature protection"
          - key: 4503599627370496
            value: "ID050 Heat sink 1 temperature protection"
          - key: 9007199254740992
            value: "ID051 Heater 2 temperature protection"
          - key: 18014398509481984
            value: "ID052 Heater 3 temperature protection"
          - key: 36028797018963968
            value: "ID053 Heatsink 4 temperature protection"
          - key: 72057594037927936
            value: "ID054 Heatsink 5 temperature protection"
          - key: 144115188075855872
            value: "ID055 Radiator 6 temperature protection"
          - key: 288230376151711744
            value: "ID056 "
          - key: 576460752303423488
            value: "ID057 Ambient temperature 1 protection"
          - key: 1152921504606846976
            value: "ID058 Ambient temperature 2 protection"
          - key: 2305843009213693952
            value: "ID059 Module 1 temperature protection"
          - key: 4611686018427387904
            value: "ID060 Module 2 temperature protection"
          - key: 9223372036854775808
            value: "ID061 Module 3 temperature protection"
          - key: 18446744073709551616
            value: "ID062 Module temperature difference is too large"
          - key: 36893488147419103232
            value: "ID063 "
          - key: 73786976294838206464
            value: "ID064 "

          # name: "Fault 5"
          # registers: [0x0409]
          - key: 147573952589676412928
            value: "No error"
          - key: 295147905179352825856
            value: "ID065 Bus voltage RMS unbalance"
          - key: 590295810358705651712
            value: "ID066 Bus voltage transient   value unbalance"
          - key: 1180591620717411303424
            value: "ID067 Undervoltage of busbar during grid connection"
          - key: 2361183241434822606848
            value: "ID068 Bus bar low voltage"
          - key: 4722366482869645213696
            value: "ID069 PV overvoltage"
          - key: 9444732965739290427392
            value: "ID070 Battery over-voltage"
          - key: 18889465931478580854784
            value: "ID071 LLCBus overvoltage protection"
          - key: 37778931862957161709568
            value: "ID072 Inverter bus voltage RMS software overvoltage"
          - key: 75557863725914323419136
            value: "ID073 Inverter bus voltage transient value software overvoltage"
          - key: 151115727451828646838272
            value: "ID074 Flying Cross Capacitor Overvoltage Protection"
          - key: 302231454903657293676544
            value: "ID075 Flying Cross capacitor undervoltage protection"
          - key: 604462909807314587353088
            value: "ID076 "
          - key: 1208925819614629174706176
            value: "ID077 "
          - key: 2417851639229258349412352
            value: "ID078 "
          - key: 4835703278458516698824704
            value: "ID079 "
          - key: 9671406556917033397649408
            value: "ID080 "

          # name: "Fault 6"
          # registers: [0x040A]
          - key: 19342813113834066795298816
            value: "No error"
          - key: 38685626227668133590597632
            value: "ID081 Battery overcurrent software protection"
          - key: 77371252455336267181195264
            value: "ID082 Dci overcurrent protection"
          - key: 154742504910672534362390528
            value: "ID083 Output transient current protection"
          - key: 309485009821345068724781056
            value: "ID084 BuckBoost software overcurrent"
          - key: 618970019642690137449562112
            value: "ID085 Output RMS current protection"
          - key: 1237940039285380274899124224
            value: "ID086 PV instantaneous current overcurrent software protection"
          - key: 2475880078570760549798248448
            value: "ID087 PV parallel uneven current"
          - key: 4951760157141521099596496896
            value: "ID088 Output current unbalance"
          - key: 9903520314283042199192993792
            value: "ID089 PV software overcurrent protection"
          - key: 19807040628566084398385987584
            value: "ID090 Balanced circuit overcurrent protection"
          - key: 39614081257132168796771975168
            value: "ID091 Resonance protection"
          - key: 79228162514264337593543950336
            value: "ID092 "
          - key: 158456325028528675187087900672
            value: "ID093 "
          - key: 316912650057057350374175801344
            value: "ID094 "
          - key: 633825300114114700748351602688
            value: "ID095 "
          - key: 1267650600228229401496703205376
            value: "ID096 "

          # name: "Fault 7"
          # registers: [0x040B]
          - key: 2535301200456458802993406410752
            value: "No error"
          - key: 5070602400912917605986812821504
            value: "ID097 LLC bus hardware overvoltage"
          - key: 10141204801825835211973625643008
            value: "ID098 Inverter bus hardware overvoltage"
          - key: 20282409603651670423947251286016
            value: "ID099 BuckBoost hardware overcurrent"
          - key: 40564819207303340847894502572032
            value: "ID100 Battery hardware overcurrent"
          - key: 81129638414606681695789005144064
            value: "ID101 "
          - key: 162259276829213363391578010288128
            value: "ID102 PV hardware overcurrent"
          - key: 324518553658426726783156020576256
            value: "ID103 AC output hardware overcurrent"
          - key: 649037107316853453566312041152512
            value: "ID104 "
          - key: 1298074214633706907132624082305024
            value: "ID105 Power meter error"
          - key: 2596148429267413814265248164610048
            value: "ID106 Serial number model error"
          - key: 5192296858534827628530496329220096
            value: "ID107 "
          - key: 10384593717069655257060992658440192
            value: "ID108 "
          - key: 20769187434139310514121985316880384
            value: "ID109 "
          - key: 41538374868278621028243970633760768
            value: "ID110 Overload protection 1"
          - key: 83076749736557242056487941267521536
            value: "ID111 Overload protection 2"
          - key: 166153499473114484112975882535043072
            value: "ID112 Overload protection 3"

          # name: "Fault 8"
          # registers: [0x040C]
          - key: 332306998946228968225951765070086144
            value: "No error"
          - key: 664613997892457936451903530140172288
            value: "ID113 Overtemperature derating"
          - key: 1329227995784915872903807060280344576
            value: "ID114 Frequency down load"
          - key: 2658455991569831745807614120560689152
            value: "ID115 Frequency loading"
          - key: 5316911983139663491615228241121378304
            value: "ID116 Voltage down load"
          - key: 10633823966279326983230456482242756608
            value: "ID117 Voltage loading"
          - key: 21267647932558653966460912964485513216
            value: "ID118 "
          - key: 42535295865117307932921825928971026432
            value: "ID119 "
          - key: 85070591730234615865843651857942052864
            value: "ID120 "
          - key: 170141183460469231731687303715884105728
            value: "ID121 Lightning protection failure (DC)"
          - key: 340282366920938463463374607431768211456
            value: "ID122 Lightning protection failure (AC)"
          - key: 680564733841876926926749214863536422912
            value: "ID123 "
          - key: 1361129467683753853853498429727072845824
            value: "ID124 Battery low voltage protection"
          - key: 2722258935367507707706996859454145691648
            value: "ID125 Battery low voltage shutdown"
          - key: 5444517870735015415413993718908291383296
            value: "ID126 Battery low voltage pre-alarm"
          - key: 10889035741470030830827987437816582766592
            value: "ID127 "
          - key: 21778071482940061661655974875633165533184
            value: "ID128 "

          # name: "Fault 9"
          # registers: [0x040D]
          - key: 43556142965880123323311949751266331066368
            value: "No error"
          - key: 87112285931760246646623899502532662132736
            value: "ID129 Output hardware overcurrent permanent fault"
          - key: 174224571863520493293247799005065324265472
            value: "ID130 Bus overvoltage permanent fault"
          - key: 348449143727040986586495598010130648530944
            value: "ID131 Bus hardware over-voltage permanent fault"
          - key: 696898287454081973172991196020261297061888
            value: "ID132 PV uneven flow permanent fault"
          - key: 1393796574908163946345982392040522594123776
            value: "ID133 Battery overcurrent permanent fault in EPS mode"
          - key: 2787593149816327892691964784081045188247552
            value: "ID134 Output transient overcurrent permanent fault"
          - key: 5575186299632655785383929568162090376495104
            value: "ID135 Output current unbalance permanent fault"
          - key: 11150372599265311570767859136324180752990208
            value: "ID136 "
          - key: 22300745198530623141535718272648361505980416
            value: "ID137 Input mode setting error permanent fault"
          - key: 44601490397061246283071436545296723011960832
            value: "ID138 Input overcurrent permanent fault"
          - key: 89202980794122492566142873090593446023921664
            value: "ID139 Input hardware overcurrent permanent fault"
          - key: 178405961588244985132285746181186892047843328
            value: "ID140 Relay permanent fault"
          - key: 356811923176489970264571492362373784095686656
            value: "ID141 Bus unbalance permanent fault"
          - key: 713623846352979940529142984724747568191373312
            value: "ID142 Lightning protection permanent fault - DC side"
          - key: 1427247692705959881058285969449495136382746624
            value: "ID143 Lightning protection permanent fault - AC side"
          - key: 2854495385411919762116571938898990272765493248
            value: "ID144 "

          # name: "Fault 10"
          # registers: [0x040E]
          - key: 5708990770823839524233143877797980545530986496
            value: "No error"
          - key: 11417981541647679048466287755595961091061972992
            value: "ID145 USB fault"
          - key: 22835963083295358096932575511191922182123945984
            value: "ID146 WIFI fault"
          - key: 45671926166590716193865151022383844364247891968
            value: "ID147 Bluetooth fault"
          - key: 91343852333181432387730302044767688728495783936
            value: "ID148 RTC clock fault"
          - key: 182687704666362864775460604089535377456991567872
            value: "ID149 Communication board EEPROM error"
          - key: 365375409332725729550921208179070754913983135744
            value: "ID150 Communication board FLASH error"
          - key: 730750818665451459101842416358141509827966271488
            value: "ID151"
          - key: 1461501637330902918203684832716283019655932542976
            value: "ID152 Safety regulation version error"
          - key: 2923003274661805836407369665432566039311865085952
            value: "ID153 SCI communication error (DC side)"
          - key: 5846006549323611672814739330865132078623730171904
            value: "ID154 SCI communication error (AC side)"
          - key: 11692013098647223345629478661730264157247460343808
            value: "ID155 SCI communication error (convergence board side)"
          - key: 23384026197294446691258957323460528314494920687616
            value: "ID156 Software version inconsistency"
          - key: 46768052394588893382517914646921056628989841375232
            value: "ID157 Lithium battery 1 communication error"
          - key: 93536104789177786765035829293842113257979682750464
            value: "ID158 Li-ion battery 2 communication error"
          - key: 187072209578355573530071658587684226515959365500928
            value: "ID159 Lithium battery 3 communication error"
          - key: 374144419156711147060143317175368453031918731001856
            value: "ID160 Lithium battery 4 communication failure"

          # name: "Fault 11"
          # registers: [0x040F]
          - key: 748288838313422294120286634350736906063837462003712
            value: "No error"
          - key: 1496577676626844588240573268701473812127674924007424
            value: "ID161 Forced shutdown"
          - key: 2993155353253689176481146537402947624255349848014848
            value: "ID162 Remote shutdown"
          - key: 5986310706507378352962293074805895248510699696029696
            value: "ID163 Drms0 shutdown"
          - key: 11972621413014756705924586149611790497021399392059392
            value: "ID164 "
          - key: 23945242826029513411849172299223580994042798784118784
            value: "ID165 Remote down load"
          - key: 47890485652059026823698344598447161988085597568237568
            value: "ID166 Logic interface down load"
          - key: 95780971304118053647396689196894323976171195136475136
            value: "ID167 Anti-Reverse Flow Downgrade"
          - key: 191561942608236107294793378393788647952342390272950272
            value: "ID168 "
          - key: 383123885216472214589586756787577295904684780545900544
            value: "ID169 Fan 1 failure"
          - key: 766247770432944429179173513575154591809369561091801088
            value: "ID170 Fan 2 failure"
          - key: 1532495540865888858358347027150309183618739122183602176
            value: "ID171 Fan 3 failure"
          - key: 3064991081731777716716694054300618367237478244367204352
            value: "ID172 Fan 4 failure"
          - key: 6129982163463555433433388108601236734474956488734408704
            value: "ID173 Fan 5 failure"
          - key: 12259964326927110866866776217202473468949912977468817408
            value: "ID174 Fan 6 failure"
          - key: 24519928653854221733733552434404946937899825954937634816
            value: "ID175 Fan 7 fault"
          - key: 49039857307708443467467104868809893875799651909875269632
            value: "ID176 Meter communication failure"

          # name: "Fault 12"
          # registers: [0x0410]
          - key: 98079714615416886934934209737619787751599303819750539264
            value: "No error"
          - key: 196159429230833773869868419475239575503198607639501078528
            value: "ID177 BMS over-voltage alarm"
          - key: 392318858461667547739736838950479151006397215279002157056
            value: "ID178 BMS undervoltage alarm"
          - key: 784637716923335095479473677900958302012794430558004314112
            value: "ID179 BMS high temperature alarm"
          - key: 1569275433846670190958947355801916604025588861116008628224
            value: "ID180 BMS low temperature alarm"
          - key: 3138550867693340381917894711603833208051177722232017256448
            value: "ID181 BMS charge/discharge overload alarm"
          - key: 6277101735386680763835789423207666416102355444464034512896
            value: "ID182 BMS short circuit alarm"
          - key: 12554203470773361527671578846415332832204710888928069025792
            value: "ID183 BMS version inconsistency"
          - key: 25108406941546723055343157692830665664409421777856138051584
            value: "ID184 BMS CAN version inconsistency"
          - key: 50216813883093446110686315385661331328818843555712276103168
            value: "ID185 BMS CAN version is too low"
          - key: 100433627766186892221372630771322662657637687111424552206336
            value: "ID186 "
          - key: 200867255532373784442745261542645325315275374222849104412672
            value: "ID187 "
          - key: 401734511064747568885490523085290650630550748445698208825344
            value: "ID188 "
          - key: 803469022129495137770981046170581301261101496891396417650688
            value: "ID189 Arc device communication failure"
          - key: 1606938044258990275541962092341162602522202993782792835301376
            value: "ID190 DC arc alarm fault"
          - key: 3213876088517980551083924184682325205044405987565585670602752
            value: "ID191 PID repair failed"
          - key: 6427752177035961102167848369364650410088811975131171341205504
            value: "ID192 PLC module heartbeat loss"

        #}}}

      - name: "Storage Control Mode"
        platform: select
        rule: 1
        registers: [0x1110]
        lookup:
          - key: 0
            value: "Self Use"
          - key: 1
            value: "Time of Use"
          - key: 2
            value: "Optimized Revenue"
          - key: 3
            value: "Passive"
          - key: 4
            value: "Peak Shaving"
          - key: 5
            value: "Off-Grid"
          - key: 6
            value: "Generator"
        icon: "mdi:power-settings"
        description: |-
          Energy storage working mode setting;
          0: Spontaneous self-use mode
          1: Time-of-use electricity price model
          2: Timing charging and discharging mode
          3: Passive mode
          4: Peak clipping mode
          5: Off-grid mode
          6：Generator mode
          Used to change the working mode.

  #}}}
  # Settings{{{
  - group: Settings
    update_interval: 300
    items:

      - name: Export Surplus Limitation
        platform: select
        rule: 1
        registers: [0x1023]
        lookup:
          - key: 0x0000
            value: "Disabled"
          - key: 0x0001
            value: "Enabled"
          - key: 0x0002
            value: "Balanced"
        description: |-
          Reflux Power control       input value 0, disable the reflux power     input value 1, power reflux enable with minimum power among the three phase      input value 2, power reflux enable with meaning value

      - name: Export Surplus Power
        platform: number
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 100
        rule: 1
        registers: [0x1024]
        range:
          min: 0
          max: 65535
        description: |-
          Reflux power

      - name: "Timed Program"
        platform: number
        rule: 1
        registers: [0x1111]
        configurable:
          mode: box
        range:
          min: 0
          max: 3
        description: |-
          Timed charging and discharging-rule number;
          The smaller the serial number, the higher the priority.
          After successfully writing to this register, the timing charge and discharge parameters will be updated to the parameters corresponding to the written serial number.

      - name: Timed Control
        platform: select
        rule: 1
        registers: [0x1112]
        lookup:
          - key: 0
            value: "Disable"
          - key: 1
            value: "Charge"
          - key: 2
            value: "Discharge"
          - key: 3
            value: "Both"
        description: |-
          Timing charge and discharge-enable control;
          Bit0: charge enable
          Bit1: Discharge enable

      - name: Timed Charge Start
        platform: time
        rule: 9
        registers: [0x1113]
        description: |-
          High byte. Charging start hour
          Low byte. Charging start minutes

      - name: Timed Charge End
        platform: time
        rule: 9
        registers: [0x1114]
        description: |-
          High byte. Charging end hour
          Low byte. Minutes after charging

      - name: Timed Discharge Start
        platform: time
        rule: 9
        registers: [0x1115]
        description: |-
          High byte. Discharge start hour
          Low byte. Discharge start minute

      - name: Timed Discharge End
        platform: time
        rule: 9
        registers: [0x1116]
        description: |-
          High byte. End of discharge hour
          Low byte. Minutes after discharge

      - name: "Timed Charge Power"
        platform: number
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 1
        registers: [0x1117, 0x1118]
        range:
          min: 0
          max: 4294967296
        description: |-
          Timed charging and discharging-charging power

      - name: "Timed Discharge Power"
        platform: number
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 1
        registers: [0x1119, 0x111A]
        range:
          min: 0
          max: 4294967296
        description: |-
          Timing charge and discharge-discharge power

      - name: Timed Set Program
        platform: button
        class: restart
        rule: 0
        code:
          write: 0x06
        registers: [0x111F]
        description: |-
          Timing charge and discharge write control;
          When the written value is 1, the value in the shadow register of timing charge and discharge is updated to the system timing charge and discharge configuration;
          When reading, return the status of the last write operation:
          0x0000: success
          0x0001: operating
          0xFFFB: The operation failed and the controller refused to respond (maybe the controller is busy or the configuration is wrong)
          0xFFFC: The operation failed and the controller did not respond
          0xFFFD: Operation failed, current function is forbidden
          0xFFFE: Operation failed, parameter storage failed
          0xFFFF: The operation failed, and the input parameters are incorrect

  #}}}

# vim: foldmethod=marker
