#
# Tested with Afore ATON BNT004KTL inverter, HW version is 1.01, inverter connected to WiFi by LSW3_15_1E20_1.14
# Inverter serial number begins ftom T6
# Setup of registers according to this document: https://docs.google.com/spreadsheets/d/19k1awt5TboVH9NZVhSO8JnN8G81JF6_9/edit?gid=953109797#gid=953109797
# from this document additional parameters may be added
#

default:
  update_interval: 5
  code: 0x04
  digits: 6

parameters:
  - group: PV
    items:
      - name: "PV1 Voltage"
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [0x022B]
        icon: "mdi:solar-power"

      - name: "PV2 Voltage"
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [0x022E]
        icon: "mdi:solar-power"

      - name: "PV1 Current"
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 1
        registers: [0x0022C]
        icon: "mdi:solar-power"

      - name: "PV2 Current"
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 1
        registers: [0x022F]
        icon: "mdi:solar-power"

      - name: "Daily Production kWh"
        class: "energy"
        state_class: "total"
        uom: "kWh"
        scale: 0.1
        rule: 1
        registers: [0x03E8]
        icon: "mdi:solar-power"

      - name: "Total Production kWh"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 1
        registers: [0x03F7, 0x03F6]
        icon: "mdi:solar-power"

      - name: "PV total power"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 1
        rule: 1
        registers: [0x022A, 0x0229]
        icon: "mdi:home-lightning-bolt"

  - group: Grid
    items:
      - name: "Total active power"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 1
        rule: 2
        registers: [0x020B, 0x020A]
        icon: "mdi:home-lightning-bolt"

      - name: "R Grid frequency"
        class: "frequency"
        state_class: "measurement"
        uom: "Hz"
        scale: 0.01
        rule: 1
        registers: [0x0201]

      - name: "R Voltage"
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [0x01FB]

      - name: "R Current"
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 2
        registers: [0x01FE]

      - name: "S Grid frequency"
        class: "frequency"
        state_class: "measurement"
        uom: "Hz"
        scale: 0.01
        rule: 1
        registers: [0x0202]

      - name: "S Voltage"
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [0x01FC]

      - name: "S Current"
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 2
        registers: [0x01FF]

      - name: "T Grid frequency"
        class: "frequency"
        state_class: "measurement"
        uom: "Hz"
        scale: 0.01
        rule: 1
        registers: [0x0203]

      - name: "T Voltage"
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [0x01FD]

      - name: "T Current"
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 2
        registers: [0x0200]

  - group: Inverter
    items:
      - name: "Transformer temperature"
        class: "temperature"
        uom: "°C"
        scale: 0.1
        rule: 2
        registers: [0x09D3]
        icon: "mdi:thermometer"

      - name: "Inverter inner temperature"
        class: "temperature"
        state_class: "measurement"
        uom: "°C"
        scale: 0.1
        rule: 2
        registers: [0x09D2]
        icon: "mdi:thermometer"

      - name: "Device State"
        rule: 1
        registers: [0x09C4]
        icon: "mdi:state-machine"
        lookup:
          - key: 0
            value: "Init"
          - key: 1
            value: "Standby"
          - key: 2
            value: "Startup"
          - key: 3
            value: "Grid"
          - key: 4
            value: "Grid disconnected"
          - key: 5
            value: "Generator"
          - key: 6
            value: "Off grid"
          - key: 7
            value: "On grid"
          - key: 8
            value: "Shutdown"
          - key: 9
            value: "Off"
          - key: 10
            value: "Error"
          - key: 11
            value: "Update"
          - key: 12
            value: "Aging"
          - key: 13
            value: "Open loop"
          - key: 14
            value: "Sampling calibration"
