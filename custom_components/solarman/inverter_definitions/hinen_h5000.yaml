# Hinen Inverter
#
# Reference: https://github.com/user-attachments/files/17622814/Inverter.Modbus.RTU.Protocol.V1.62.20240927.xlsx
#
# Tested with Hinen H5000-EU


info:
  manufacturer: Hinen
  model: H5000-EU

default:
  update_interval: 15
  digits: 4
  code: 0x04

parameters:
  - group: solar
    items:
      - name: "Lifetime Energy Production"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: .1
        rule: 1
        registers: [275, 274]
        icon: "mdi:solar-power"

      - name: "Current Solar Production"
        class: "energy"
        state_class: "total_increasing"
        uom: "Wh"
        scale: .1
        rule: 2
        registers: [340, 339]
        icon: mdi:solar-panel

      - name: "Daily Energy Production"
        class: "energy"
        state_class: "total_increasing"
        uom: "kW"
        scale: 0.1
        rule: 2
        registers: [273, 272]
        icon: mdi:sun-angle

      - name: "Daily Energy Consumption"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: .1
        rule: 2
        registers: [301, 300]
        icon: mdi:home

      - name: "Daily Grid Feed-In"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: .1
        rule: 2
        registers: [305, 304]
        icon: mdi:transmission-tower-import

      - name: "Daily Grid Purchase"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: .1
        rule: 2
        registers: [309, 308]
        icon: mdi:transmission-tower-export

      - name: "Lifetime Grid Purchase"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: .1
        rule: 2
        registers: [311, 310]
        icon: mdi:transmission-tower-export

      - name: "Lifetime Grid Feed-In"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: .1
        rule: 2
        registers: [307, 306]
        icon: mdi:transmission-tower-import

  - group: Battery
    items:
      - name: "Battery"
        class: "battery"
        state_class: "measurement"
        uom: "%"
        scale: 1
        rule: 1
        registers: [128]
        icon: mdi:home-battery

      - name: "Battery Health"
        class: "battery"
        state_class: "measurement"
        uom: "%"
        scale: 1
        rule: 1
        registers: [174]
        icon: mdi:battery-heart

      - name: "Battery Temperature"
        class: "battery"
        state_class: "measurement"
        uom: "°"
        scale: 0.1
        rule: 1
        registers: [136]
        icon: mdi:thermometer

      - name: "Battery Voltage"
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [127]
        icon: mdi:flash

      - name: "Battery Discharge Power"
        class: "energy"
        state_class: "total_increasing"
        uom: "Wh"
        scale: 0.1
        rule: 2
        registers: [103, 102]
        icon: mdi:battery-minus

      - name: "Battery Charge Power"
        class: "energy"
        state_class: "total_increasing"
        uom: "Wh"
        scale: 0.1
        rule: 2
        registers: [105, 104]
        icon: mdi:battery-plus

      - name: "Battery Priority"
        class: ""
        state_class: ""
        uom: ""
        scale: 1
        rule: 1
        isstr: true
        registers: [125]
        icon: mdi:battery-sync
        lookup:
          - key: 0
            value: "Load Priority"
          - key: 1
            value: "Battery Priority"
          - key: 2
            value: "Grid Priority"

      - name: "Battery Daily Charging Energy"
        class: "energy"
        state_class: "total_increasing"
        uom: "kW"
        scale: 0.1
        rule: 2
        registers: [277, 276]
        icon: "mdi:battery-plus"

      - name: "Battery Daily Discharging Energy"
        class: "energy"
        state_class: "total_increasing"
        uom: "kW"
        scale: 0.1
        rule: 2
        registers: [281, 280]
        icon: "mdi:battery-minus"

      - name: "Battery Lifetime Charge Energy"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 2
        registers: [279, 278]
        icon: "mdi:battery-plus"

      - name: "Battery Lifetime Discharge Energy"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 2
        registers: [283, 282]
        icon: "mdi:battery-minus"

      - name: "Battery State"
        class: "enum"
        rule: 0
        options: ["charging", "idle", "discharging"]
        icon: mdi:battery

  - group: Inverter
    items:
      - name: "Current Consumption"
        class: "energy"
        state_class: "total_increasing"
        uom: "Wh"
        scale: 0.1
        rule: 2
        registers: [77, 76]
        icon: mdi:flash

      - name: "Running Status"
        class: ""
        state_class: ""
        uom: ""
        scale: 1
        rule: 1
        registers: [0]
        isstr: true
        lookup:
          - key: 0
            value: "Stand-by"
          - key: 1
            value: "Grid-connected"
          - key: 2
            value: "Off-grid"
          - key: 3
            value: "FAULT"
          - key: 4
            value: "Update mode"
          - key: 5
            value: "Charging"
          - key: 6
            value: "Discharging"
          - key: 7
            value: "Bypass"
        icon: "mdi:home-lightning-bolt"

      - name: "Inverter Temperature"
        class: "value"
        uom: "°"
        scale: 0.1
        rule: 2
        registers: [132]
        icon: "mdi:thermometer"
